---
- name: Download kubectl (desired version).
  get_url:
    url: "https://s3.us-west-2.amazonaws.com/amazon-eks/{{ kubectl_version }}/bin/linux/amd64/kubectl"
    dest: /usr/local/bin/kubectl
    mode: '0755'
  vars:
    kubectl_version: "1.33.0/2025-05-01"

- name: Verify if kubectl is installed correctly.
  command: kubectl version --client
  register: kubectl_version_output
  changed_when: false

- name: Show kubectl version.
  debug:
    var: kubectl_version_output.stdout

- name: Download and install kubectx.
  get_url:
    url: https://github.com/ahmetb/kubectx/releases/latest/download/kubectx
    dest: /usr/local/bin/kubectx
    mode: '0755'

- name: Download and install kubens.
  get_url:
    url: https://github.com/ahmetb/kubectx/releases/latest/download/kubens
    dest: /usr/local/bin/kubens
    mode: '0755'

- name: Download and install kube-score.
  get_url:
    url: https://github.com/zegl/kube-score/releases/download/v{{ kube_score_version }}/kube-score_{{ kube_score_version }}_linux_amd64
    dest: /usr/local/bin/kube-score
    mode: '0755'
  vars:
    kube_score_version: "1.20.0"

- name: Download and install kube-capacity.
  get_url:
    url: https://github.com/robscott/kube-capacity/releases/download/v{{ kube_capacity_version }}/kube-capacity_v{{ kube_capacity_version }}_linux_x86_64.tar.gz
    dest: /usr/local/bin/kube-capacity
    mode: '0755'
  vars:
    kube_capacity_version: "0.8.0"

- name: Download and install stern.
  get_url:
    url: https://github.com/stern/stern/releases/download/v{{ stern_version }}/stern_{{ stern_version }}_linux_amd64.tar.gz
    dest: /usr/local/bin/stern
    mode: '0755'
  vars:
    stern_version: "1.32.0"

- name: Download and install kube-no-trouble.
  get_url:
    url: https://github.com/doitintl/kube-no-trouble/releases/download/v{{ kubent_version }}/kubent-{{ kubent_version }}-linux-amd64.tar.gz
    dest: /usr/local/bin/kubent
    mode: '0755'
  vars:
    kubent_version: "0.7.3"


- name: Download and install K9s.
  get_url:
    url: "https://github.com/derailed/k9s/releases/download/{{ k9s_version }}/k9s_Linux_amd64.tar.gz"
    dest: "/tmp/k9s.tar.gz"
    mode: '0644'
  vars:
    k9s_version: "v0.50.9"

- name: Unarchive and install K9s.
  unarchive:
    src: "/tmp/k9s.tar.gz"
    dest: "/usr/local/bin/"
    remote_src: yes
    mode: '0755'
